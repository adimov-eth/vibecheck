# VibeCheck Project Status & Examination Guide

**Last Updated**: December 6, 2025  
**Generated By**: Claude Code Assistant  
**Purpose**: Comprehensive project overview for server-side examination

---

## 🎯 Executive Summary

VibeCheck is a **conversation intelligence platform** consisting of:
- **Mobile App**: React Native/Expo with TypeScript
- **Backend API**: Bun runtime with Express-like server
- **Key Features**: Audio recording → transcription → AI analysis → insights

**Current Status**: Advanced development stage with complete infrastructure, ready for deployment testing and feature validation.

---

## 🏗️ Architecture Overview

### System Components
```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   Mobile App    │────│   Backend API    │────│   External APIs │
│ (React Native)  │    │  (Bun/Express)   │    │ (OpenAI, Apple) │
└─────────────────┘    └──────────────────┘    └─────────────────┘
                              │
                    ┌──────────┼──────────┐
                    │          │          │
               ┌─────────┐ ┌─────────┐ ┌─────────┐
               │ SQLite  │ │  Redis  │ │ Object  │
               │Database │ │ Cache/  │ │Storage  │
               │         │ │ Queue   │ │         │
               └─────────┘ └─────────┘ └─────────┘
```

### Tech Stack
- **Runtime**: Bun 1.2.9
- **Frontend**: React Native 0.76.9 + Expo ~52.0.40
- **Backend**: Express 4.21.2 + TypeScript
- **Database**: SQLite with WAL mode (production: PostgreSQL recommended)
- **Cache/Queue**: Redis with BullMQ
- **State Management**: Zustand
- **Package Managers**: pnpm (frontend), bun (backend)

---

## 📁 Project Structure

```
final/
├── check/                    # Backend API Server
│   ├── src/
│   │   ├── api/             # API routes and handlers
│   │   ├── database/        # Database layer (SQLite + migrations)
│   │   ├── middleware/      # Auth, rate limiting, error handling
│   │   ├── queues/          # BullMQ job queue management
│   │   ├── services/        # Business logic services
│   │   ├── utils/           # Utilities (logger, validation, etc.)
│   │   ├── workers/         # Background workers (audio, GPT, cleanup)
│   │   └── types/           # TypeScript type definitions
│   ├── uploads/             # Local file storage
│   ├── app.db*              # SQLite database files
│   └── package.json         # Backend dependencies
│
├── vibe/                    # React Native Mobile App
│   ├── app/                 # Expo Router screens
│   ├── components/          # Reusable UI components
│   ├── hooks/               # Custom React hooks
│   ├── services/            # API clients and utilities
│   ├── state/               # Zustand store slices
│   ├── utils/               # Utility functions
│   └── package.json         # Frontend dependencies
│
├── PRD.md                   # Product Requirements Document
├── architecture_analysis_report.md
└── CLAUDE.md                # Development guidelines
```

---

## 🔧 Development Environment Setup

### Prerequisites
- **Bun**: v1.2.9+ (backend runtime)
- **pnpm**: v10.6.3+ (frontend package manager)
- **Redis**: For caching and job queues
- **Node.js**: For Expo CLI (if not using bunx)

### Quick Start Commands

#### Backend (check directory)
```bash
cd check
bun install                  # Install dependencies
bun run dev                  # Start development server (port 3000)
bun run workers             # Start background workers
bun run db:migrate          # Run database migrations
bun run lint                # Run ESLint
```

#### Frontend (vibe directory)
```bash
cd vibe
pnpm install                # Install dependencies
pnpm start                  # Start Expo development server
pnpm lint                   # Run linter
```

---

## 🗄️ Database Schema (SQLite v3)

### Core Tables
```sql
users (
  id TEXT PRIMARY KEY,              -- Format: "apple:<SUB_VALUE>"
  email TEXT UNIQUE NOT NULL,
  name TEXT,
  appAccountToken TEXT UNIQUE,      -- Apple App Account Token (UUID)
  createdAt INTEGER,
  updatedAt INTEGER
)

conversations (
  id TEXT PRIMARY KEY,              -- UUIDv7
  userId TEXT NOT NULL,
  mode TEXT NOT NULL,               -- "mediator", "counselor", etc.
  recordingType TEXT NOT NULL,      -- "separate" or "live"
  status TEXT DEFAULT 'waiting',    -- "waiting", "processing", "completed", "failed"
  gptResponse TEXT,                 -- AI analysis result
  errorMessage TEXT,
  createdAt INTEGER,
  updatedAt INTEGER
)

audios (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  conversationId TEXT NOT NULL,
  userId TEXT NOT NULL,
  audioFile TEXT,                   -- Storage path/URL
  audioKey TEXT,                    -- "partner1", "partner2", "live"
  transcription TEXT,
  status TEXT DEFAULT 'uploaded',   -- "uploaded", "transcribing", "transcribed", "failed"
  errorMessage TEXT,
  createdAt INTEGER,
  updatedAt INTEGER
)

subscriptions (
  id TEXT PRIMARY KEY,              -- originalTransactionId from Apple
  userId TEXT NOT NULL,
  originalTransactionId TEXT UNIQUE,
  productId TEXT NOT NULL,
  status TEXT NOT NULL,             -- "active", "expired", "grace_period", etc.
  environment TEXT NOT NULL,        -- "Sandbox" or "Production"
  expiresDate INTEGER,              -- Unix timestamp
  purchaseDate INTEGER NOT NULL,
  lastTransactionId TEXT NOT NULL,
  lastTransactionInfo TEXT,         -- JSON string
  lastRenewalInfo TEXT,             -- JSON string
  appAccountToken TEXT,
  subscriptionGroupIdentifier TEXT,
  offerType INTEGER,
  offerIdentifier TEXT,
  createdAt INTEGER,
  updatedAt INTEGER
)
```

---

## 🔐 Environment Configuration

### Backend (.env)
```env
PORT=3000
OPENAI_API_KEY=sk-proj-...
REDIS_HOST=localhost
REDIS_PORT=6379
APPLE_SHARED_SECRET=176661aa0e9e44969265ee7adc792391
JWT_SECRET=ad32a6b0ce00a91b3bdf2e2f68afeea7...
JWT_EXPIRES_IN=7d
```

### Frontend (.env)
```env
EXPO_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_live_...
EXPO_PUBLIC_API_URL=https://v.bkk.lol
APPLE_SHARED_SECRET=176661aa0e9e44969265ee7adc792391
```

---

## 🚀 API Endpoints Overview

### Authentication
- `POST /auth/apple` - Apple Sign-In verification
- Middleware: JWT-based session authentication

### Conversations
- `POST /conversations` - Create new conversation
- `GET /conversations` - List user conversations (paginated)
- `GET /conversations/:id` - Get conversation details
- `DELETE /conversations/:id` - Delete conversation

### Audio Processing
- `POST /conversations/:serverId/audio/:audioKey` - Upload audio file
- Background processing: Transcription → Analysis → Notification

### Subscriptions
- `POST /webhooks/apple/notifications` - Apple S2S webhook
- `GET /subscriptions/status` - Check user subscription status

### Real-time Updates
- `WebSocket /ws` - Real-time status updates and results delivery

---

## 🔄 Background Processing Flow

```
Audio Upload → Object Storage → Transcription Queue → OpenAI API → 
Analysis Queue → GPT Processing → Results → WebSocket/Push Notification
```

### Workers
1. **Audio Worker**: Handles transcription via OpenAI Whisper
2. **GPT Worker**: Processes conversation analysis
3. **Cleanup Worker**: Manages file cleanup and optimization
4. **Notification Worker**: Sends push notifications

---

## 📱 Mobile App Features

### Core Screens
- **Authentication**: Apple Sign-In integration
- **Home**: Conversation mode selection
- **Recording**: Audio capture with real-time UI
- **Results**: Live updates and analysis display
- **Profile**: Account settings and subscription management

### Key Components
- **RecordButton**: Audio recording with visual feedback
- **AudioWaveform**: Real-time audio visualization
- **ResultsView**: Loading states and analysis display
- **ModeCard**: Conversation mode selection UI

### State Management (Zustand)
- **conversationSlice**: Conversation CRUD operations
- **uploadSlice**: Background upload queue management
- **websocketSlice**: Real-time connection handling
- **subscriptionSlice**: Subscription status and IAP

---

## 🧪 Testing & Quality

### Code Quality Tools
- **ESLint**: Configured for both projects
- **TypeScript**: Strict mode enabled
- **Biome**: Code formatting (configured but optional)

### Testing Commands
```bash
# Backend
cd check && bun test -- -t "test name"

# Frontend  
cd vibe && pnpm test -- -t "test name"
```

---

## 🚀 Deployment Considerations

### Production Recommendations
1. **Database Migration**: SQLite → PostgreSQL for scalability
2. **Redis Clustering**: High availability setup
3. **Containerization**: Docker setup for backend services
4. **Monitoring**: Add metrics collection and alerting
5. **Object Storage**: Configure AWS S3/CloudFlare R2/GCS

### Current Deployment Status
- ✅ Backend configured for local development
- ✅ Environment variables properly structured
- ⚠️ Production deployment configs not present in codebase
- ⚠️ Docker/containerization files not found

---

## 🔍 Server Examination Checklist

When examining the server, check:

### 1. Process Status
```bash
# Check if backend is running
ps aux | grep bun
netstat -tlnp | grep :3000

# Check Redis
redis-cli ping
ps aux | grep redis
```

### 2. Database Health
```bash
cd /path/to/project/check
sqlite3 app.db ".schema"
sqlite3 app.db "SELECT COUNT(*) FROM users;"
sqlite3 app.db "PRAGMA user_version;"
```

### 3. Log Analysis
```bash
# Check application logs
journalctl -f -u your-app-service
# Or check log files if using file logging
tail -f /path/to/logs/app.log
```

### 4. Service Dependencies
```bash
# Redis connectivity
redis-cli ping

# Disk space for uploads
df -h /path/to/project/check/uploads

# Memory usage
free -h
top -p $(pgrep -f "bun.*index.ts")
```

### 5. Network & Connectivity
```bash
# Check if API is responding
curl -I http://localhost:3000/health
# Or if deployed:
curl -I https://your-domain.com/health

# Check WebSocket endpoint
# Use wscat or similar tool
```

### 6. Queue Status (if Redis is running)
```bash
redis-cli
> KEYS bull:*
> LLEN bull:audioProcessing:waiting
> LLEN bull:gptProcessing:waiting
```

---

## 🐛 Common Issues & Troubleshooting

### Backend Issues
- **Port 3000 in use**: Check `netstat -tlnp | grep :3000`
- **Redis connection failed**: Verify Redis service and config
- **Database locked**: Check SQLite WAL files and permissions
- **OpenAI API errors**: Verify API key and quota

### Frontend Issues
- **Expo CLI not found**: Install globally or use `bunx expo`
- **Metro bundler issues**: Clear cache with `pnpm start --clear`
- **iOS build issues**: Check Xcode and pod dependencies

### Performance Concerns
- **Large upload directory**: Monitor disk usage
- **Memory leaks**: Check worker process memory
- **Database performance**: Monitor query execution time

---

## 📋 Next Steps for Server Examination

1. **Verify Environment Setup**
   - Check all environment variables are present
   - Validate external service connectivity (OpenAI, Apple)

2. **Database Integrity**
   - Run migration status check
   - Verify data consistency
   - Check index performance

3. **Service Health**
   - Test all API endpoints
   - Verify WebSocket connectivity
   - Check background worker status

4. **Performance Baseline**
   - Measure API response times
   - Monitor memory/CPU usage
   - Test file upload performance

5. **Security Audit**
   - Verify JWT token validation
   - Check rate limiting effectiveness
   - Validate input sanitization

---

## 📞 Development Guidelines Reference

See `CLAUDE.md` for:
- Coding standards and conventions
- Import organization patterns
- Error handling best practices
- Logging guidelines

## 📚 Additional Documentation

- **PRD.md**: Complete product requirements and feature specifications
- **architecture_analysis_report.md**: Detailed system architecture analysis with diagrams and recommendations

---

*This document provides a comprehensive overview for examining the VibeCheck project on a server environment. Use it as a guide for system health checks, debugging, and further development.*